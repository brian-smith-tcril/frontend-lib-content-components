{"version":3,"file":"hooks.js","names":["_react","require","_frontendComponentsTinymceAdvancedPlugins","_i18n","_tinyMCEStyles","_interopRequireDefault","_utils","_pluginConfig","_module","_interopRequireWildcard","_tinyMCE","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","prototype","hasOwnProperty","call","i","set","obj","ownKeys","keys","getOwnPropertySymbols","o","filter","enumerable","push","apply","_objectSpread","arguments","length","forEach","_defineProperty","getOwnPropertyDescriptors","defineProperties","key","value","_toPropertyKey","configurable","writable","_toPrimitive","String","Symbol","toPrimitive","TypeError","Number","state","exports","StrictDict","isImageModalOpen","val","useState","isSourceCodeModalOpen","imageSelection","refReady","isInsertLinkModalOpen","addImagesAndDimensionsToRef","_ref","imagesRef","assets","editorContentHtml","imagesWithDimensions","module","filterAssets","map","image","imageFragment","getImageFromHtmlString","url","width","height","current","useImages","_ref2","useRef","useEffect","parseContentForLabels","_ref3","editor","updateContent","content","getContent","parsedLabels","split","updatedContent","label","startsWith","endsWith","previousLabel","nextLabel","replace","replaceStaticwithAsset","_ref4","imageUrls","editorType","lmsEndpointUrl","imageSrcs","src","currentContent","staticFullUrl","isStatic","isExpandableAsset","assetSrc","substring","indexOf","assetName","staticName","displayName","currentSrc","setContent","getImageResizeHandler","_ref5","setImage","alt","selection","getNode","updateImageDimensions","images","result","externalUrl","altText","setupCustomBehavior","_ref6","openImgModal","openSourceCodeModal","openInsertLinkModal","translations","ui","registry","addButton","tinyMCE","buttons","imageUploadButton","icon","tooltip","onAction","editImageSettings","openModalWithSelectedImage","addToggleButton","insertLink","insertLinkTooltipTitle","onSetup","api","on","node","isLink","nodeName","hasTextSelected","setActive","setDisabled","code","text","setupCodeFormatting","formatter","formatChanged","active","toggleCodeFormatting","toggle","undoManager","add","focus","codeBlock","toggleLabelFormatting","execCommand","addIcon","textToSpeechIcon","command","remove","removeProtocolFromUrl","editorConfig","_ref7","setEditorRef","studioEndpointUrl","isLibrary","placeholder","initializeEditor","setSelection","minHeight","toolbar","config","plugins","imageToolbar","quickbarsInsertToolbar","quickbarsSelectionToolbar","pluginConfig","onInit","evt","initialValue","init","skin","content_css","content_style","tinyMCEStyles","a11ycheckerCss","min_height","contextmenu","document_base_url","imagetools_cors_hosts","imagetools_toolbar","formats","inline","setup","fetchImageUrls","quickbars_insert_toolbar","quickbars_selection_toolbar","quickbars_image_toolbar","valid_children","valid_elements","entity_encoding","prepareEditorRef","editorRef","useCallback","ref","setRefReady","imgModalToggle","isImgOpen","setIsOpen","closeImgModal","insertLinkModalToggle","isInsertLinkOpen","setIsInsertLinkOpen","closeInsertLinkModal","useTranslations","messages","undefined","intl","useIntl","messagesKeys","translationsFormatted","reduce","prevMessages","messageKey","formatMessage","sourceCodeModalToggle","isSourceCodeOpen","closeSourceCodeModal","imageMatchRegex","matchImageStringsByIdentifiers","b","matchA","JSON","stringify","match","slice","matchB","stringToFragment","htmlString","document","createRange","createContextualFragment","imageSrc","querySelectorAll","Array","from","find","img","detectImageMatchingError","_ref8","matchingImages","tinyMceHTML","id","_ref9","mceSrc","imageMatchingErrorDetected","_ref10","assetsList","values","asset","contentType","setAssetToStaticUrl","_ref11","editorValue","regExLmsEndpointUrl","RegExp","assetUrls","portableUrl","assetSrcs","assetBlockName","search","nameFromEditorSrc","nameFromStudioSrc","selectedImage","clearSelection","_ref12","foundMatch","imageIdentifier","isMatch"],"sources":["../../../../src/editors/sharedComponents/TinyMceWidget/hooks.js"],"sourcesContent":["import {\n  useState,\n  useRef,\n  useCallback,\n  useEffect,\n} from 'react';\nimport { a11ycheckerCss } from 'frontend-components-tinymce-advanced-plugins';\nimport { useIntl } from '@edx/frontend-platform/i18n';\nimport tinyMCEStyles from '../../data/constants/tinyMCEStyles';\nimport { StrictDict } from '../../utils';\nimport pluginConfig from './pluginConfig';\nimport * as module from './hooks';\nimport tinyMCE from '../../data/constants/tinyMCE';\n\nexport const state = StrictDict({\n  // eslint-disable-next-line react-hooks/rules-of-hooks\n  isImageModalOpen: (val) => useState(val),\n  // eslint-disable-next-line react-hooks/rules-of-hooks\n  isSourceCodeModalOpen: (val) => useState(val),\n  // eslint-disable-next-line react-hooks/rules-of-hooks\n  imageSelection: (val) => useState(val),\n  // eslint-disable-next-line react-hooks/rules-of-hooks\n  refReady: (val) => useState(val),\n  // eslint-disable-next-line react-hooks/rules-of-hooks\n  isInsertLinkModalOpen: (val) => useState(val),\n});\n\nexport const addImagesAndDimensionsToRef = ({ imagesRef, assets, editorContentHtml }) => {\n  const imagesWithDimensions = module.filterAssets({ assets }).map((image) => {\n    const imageFragment = module.getImageFromHtmlString(editorContentHtml, image.url);\n    return { ...image, width: imageFragment?.width, height: imageFragment?.height };\n  });\n\n  imagesRef.current = imagesWithDimensions;\n};\n\nexport const useImages = ({ assets, editorContentHtml }) => {\n  const imagesRef = useRef([]);\n\n  useEffect(() => {\n    module.addImagesAndDimensionsToRef({ imagesRef, assets, editorContentHtml });\n  }, []);\n\n  return { imagesRef };\n};\n\nexport const parseContentForLabels = ({ editor, updateContent }) => {\n  let content = editor.getContent();\n  if (content && content?.length > 0) {\n    const parsedLabels = content.split(/<label>|<\\/label>/gm);\n    let updatedContent;\n    parsedLabels.forEach((label, i) => {\n      if (!label.startsWith('<') && !label.endsWith('>')) {\n        let previousLabel = parsedLabels[i - 1];\n        let nextLabel = parsedLabels[i + 1];\n        if (!previousLabel.endsWith('<p>')) {\n          previousLabel = `${previousLabel}</p><p>`;\n          updatedContent = content.replace(parsedLabels[i - 1], previousLabel);\n          content = updatedContent;\n          updateContent(content);\n        }\n        if (!nextLabel.startsWith('</p>')) {\n          nextLabel = `</p><p>${nextLabel}`;\n          updatedContent = content.replace(parsedLabels[i + 1], nextLabel);\n          content = updatedContent;\n          updateContent(content);\n        }\n      }\n    });\n  } else {\n    updateContent(content);\n  }\n};\n\nexport const replaceStaticwithAsset = ({\n  editor,\n  imageUrls,\n  editorType,\n  lmsEndpointUrl,\n  updateContent,\n}) => {\n  let content = editor.getContent();\n  const imageSrcs = content.split('src=\"');\n  imageSrcs.forEach(src => {\n    const currentContent = content;\n    let staticFullUrl;\n    const isStatic = src.startsWith('/static/');\n    const isExpandableAsset = src.startsWith('/assets/') && editorType === 'expandable';\n    if ((isStatic || isExpandableAsset) && imageUrls.length > 0) {\n      const assetSrc = src.substring(0, src.indexOf('\"'));\n      const assetName = assetSrc.replace(/\\/assets\\/.+[^/]\\//g, '');\n      const staticName = assetSrc.substring(8);\n      imageUrls.forEach((url) => {\n        if (isExpandableAsset && assetName === url.displayName) {\n          staticFullUrl = `${lmsEndpointUrl}${url.staticFullUrl}`;\n        } else if (staticName === url.displayName) {\n          staticFullUrl = url.staticFullUrl;\n          if (isExpandableAsset) {\n            staticFullUrl = `${lmsEndpointUrl}${url.staticFullUrl}`;\n          }\n        }\n      });\n      if (staticFullUrl) {\n        const currentSrc = src.substring(0, src.indexOf('\"'));\n        content = currentContent.replace(currentSrc, staticFullUrl);\n        if (editorType === 'expandable') {\n          updateContent(content);\n        } else {\n          editor.setContent(content);\n        }\n      }\n    }\n  });\n};\n\nexport const getImageResizeHandler = ({ editor, imagesRef, setImage }) => () => {\n  const {\n    src, alt, width, height,\n  } = editor.selection.getNode();\n\n  imagesRef.current = module.updateImageDimensions({\n    images: imagesRef.current, url: src, width, height,\n  }).result;\n\n  setImage({\n    externalUrl: src,\n    altText: alt,\n    width,\n    height,\n  });\n};\n\nexport const setupCustomBehavior = ({\n  updateContent,\n  openImgModal,\n  openSourceCodeModal,\n  openInsertLinkModal,\n  translations,\n  editorType,\n  imageUrls,\n  images,\n  setImage,\n  lmsEndpointUrl,\n}) => (editor) => {\n  // image upload button\n  editor.ui.registry.addButton(tinyMCE.buttons.imageUploadButton, {\n    icon: 'image',\n    tooltip: 'Add Image',\n    onAction: openImgModal,\n  });\n  // editing an existing image\n  editor.ui.registry.addButton(tinyMCE.buttons.editImageSettings, {\n    icon: 'image',\n    tooltip: 'Edit Image Settings',\n    onAction: module.openModalWithSelectedImage({\n      editor, images, setImage, openImgModal,\n    }),\n  });\n\n  // insert link button\n  /* addButton only has setDisabled/isDisabled in api while\n    addToggleButton has setDisabled/isDisabled/setActive/isActive\n    addButton doc: https://www.tiny.cloud/docs/ui-components/typesoftoolbarbuttons/#basicbutton\n    addToggleButton: doc: https://www.tiny.cloud/docs/ui-components/typesoftoolbarbuttons/#togglebutton\n  */\n  editor.ui.registry.addToggleButton(tinyMCE.buttons.insertLink, {\n    icon: 'new-tab',\n    tooltip: translations?.insertLinkTooltipTitle ?? '',\n    onAction: openInsertLinkModal,\n    onSetup(api) {\n      editor.on('SelectionChange', () => {\n        const node = editor.selection.getNode();\n        const isLink = node.nodeName === 'A';\n        const hasTextSelected = editor.selection.getContent().length > 0;\n        api.setActive(isLink);\n        api.setDisabled(!isLink && !hasTextSelected);\n      });\n    },\n  });\n\n  // overriding the code plugin's icon with 'HTML' text\n  editor.ui.registry.addButton(tinyMCE.buttons.code, {\n    text: 'HTML',\n    tooltip: 'Source code',\n    onAction: openSourceCodeModal,\n  });\n  // add a custom simple inline code block formatter.\n  const setupCodeFormatting = (api) => {\n    editor.formatter.formatChanged(\n      'code',\n      (active) => api.setActive(active),\n    );\n  };\n  const toggleCodeFormatting = () => {\n    editor.formatter.toggle('code');\n    editor.undoManager.add();\n    editor.focus();\n  };\n  editor.ui.registry.addToggleButton(tinyMCE.buttons.codeBlock, {\n    icon: 'sourcecode',\n    tooltip: 'Code Block',\n    onAction: toggleCodeFormatting,\n    onSetup: setupCodeFormatting,\n  });\n  // add a custom simple inline label formatter.\n  const toggleLabelFormatting = () => {\n    editor.execCommand('mceToggleFormat', false, 'label');\n  };\n  editor.ui.registry.addIcon('textToSpeech', tinyMCE.textToSpeechIcon);\n  editor.ui.registry.addButton('customLabelButton', {\n    icon: 'textToSpeech',\n    text: 'Label',\n    tooltip: 'Apply a \"Question\" label to specific text, recognized by screen readers. Recommended to improve accessibility.',\n    onAction: toggleLabelFormatting,\n  });\n  if (editorType === 'expandable') {\n    editor.on('init', () => {\n      module.replaceStaticwithAsset({\n        editor,\n        imageUrls,\n        editorType,\n        lmsEndpointUrl,\n        updateContent,\n      });\n    });\n  }\n  editor.on('ExecCommand', (e) => {\n    if (editorType === 'text' && e.command === 'mceFocus') {\n      module.replaceStaticwithAsset({ editor, imageUrls });\n    }\n    if (e.command === 'RemoveFormat') {\n      editor.formatter.remove('blockquote');\n      editor.formatter.remove('label');\n    }\n  });\n  // after resizing an image in the editor, synchronize React state and ref\n  editor.on('ObjectResized', getImageResizeHandler({ editor, imagesRef: images, setImage }));\n};\n\n// imagetools_cors_hosts needs a protocol-sanatized url\nexport const removeProtocolFromUrl = (url) => url.replace(/^https?:\\/\\//, '');\n\nexport const editorConfig = ({\n  editorType,\n  setEditorRef,\n  editorContentHtml,\n  images,\n  lmsEndpointUrl,\n  studioEndpointUrl,\n  isLibrary,\n  placeholder,\n  initializeEditor,\n  openImgModal,\n  openSourceCodeModal,\n  openInsertLinkModal,\n  translations = {},\n  setSelection,\n  updateContent,\n  content,\n  minHeight,\n}) => {\n  const {\n    toolbar,\n    config,\n    plugins,\n    imageToolbar,\n    quickbarsInsertToolbar,\n    quickbarsSelectionToolbar,\n  } = pluginConfig({ isLibrary, placeholder, editorType });\n\n  return {\n    onInit: (evt, editor) => {\n      setEditorRef(editor);\n      if (editorType === 'text') {\n        initializeEditor();\n      }\n    },\n    initialValue: editorContentHtml || '',\n    init: {\n      ...config,\n      skin: false,\n      content_css: false,\n      content_style: tinyMCEStyles + a11ycheckerCss,\n      min_height: minHeight,\n      contextmenu: 'link table',\n      document_base_url: lmsEndpointUrl,\n      imagetools_cors_hosts: [removeProtocolFromUrl(lmsEndpointUrl), removeProtocolFromUrl(studioEndpointUrl)],\n      imagetools_toolbar: imageToolbar,\n      formats: { label: { inline: 'label' } },\n      setup: module.setupCustomBehavior({\n        editorType,\n        updateContent,\n        openImgModal,\n        openSourceCodeModal,\n        openInsertLinkModal,\n        translations,\n        lmsEndpointUrl,\n        setImage: setSelection,\n        content,\n        images,\n        imageUrls: module.fetchImageUrls(images),\n      }),\n      quickbars_insert_toolbar: quickbarsInsertToolbar,\n      quickbars_selection_toolbar: quickbarsSelectionToolbar,\n      quickbars_image_toolbar: false,\n      toolbar,\n      plugins,\n      valid_children: '+body[style]',\n      valid_elements: '*[*]',\n      entity_encoding: 'utf-8',\n    },\n  };\n};\n\nexport const prepareEditorRef = () => {\n  // eslint-disable-next-line react-hooks/rules-of-hooks\n  const editorRef = useRef(null);\n  // eslint-disable-next-line react-hooks/rules-of-hooks\n  const setEditorRef = useCallback((ref) => {\n    editorRef.current = ref;\n  }, []);\n  const [refReady, setRefReady] = module.state.refReady(false);\n  // eslint-disable-next-line react-hooks/rules-of-hooks\n  useEffect(() => setRefReady(true), []);\n  return { editorRef, refReady, setEditorRef };\n};\n\nexport const imgModalToggle = () => {\n  const [isImgOpen, setIsOpen] = module.state.isImageModalOpen(false);\n  return {\n    isImgOpen,\n    openImgModal: () => setIsOpen(true),\n    closeImgModal: () => setIsOpen(false),\n  };\n};\n\nexport const insertLinkModalToggle = () => {\n  const [isInsertLinkOpen, setIsInsertLinkOpen] = module.state.isInsertLinkModalOpen(false);\n  return {\n    isInsertLinkOpen,\n    openInsertLinkModal: () => setIsInsertLinkOpen(true),\n    closeInsertLinkModal: () => setIsInsertLinkOpen(false),\n  };\n};\n\nexport const useTranslations = (messages = {}) => {\n  const intl = useIntl();\n  const messagesKeys = Object.keys(messages);\n  const translationsFormatted = messagesKeys.reduce(\n    (prevMessages, messageKey) => ({\n      ...prevMessages,\n      [messageKey]: intl.formatMessage(messages[messageKey]),\n    }),\n    {},\n  );\n\n  return translationsFormatted;\n};\n\nexport const sourceCodeModalToggle = (editorRef) => {\n  const [isSourceCodeOpen, setIsOpen] = module.state.isSourceCodeModalOpen(false);\n  return {\n    isSourceCodeOpen,\n    openSourceCodeModal: () => setIsOpen(true),\n    closeSourceCodeModal: () => {\n      setIsOpen(false);\n      editorRef.current.focus();\n    },\n  };\n};\n\n/**\n * const imageMatchRegex\n *\n * Image urls and ids used in the TinyMceEditor vary wildly, with different base urls,\n * different lengths and constituent parts, and replacement of some \"/\" with \"@\".\n * Common are the keys \"asset-v1\", \"type\", and \"block\", each holding a value after some separator.\n * This regex captures only the values for these keys using capture groups, which can be used for matching.\n */\nexport const imageMatchRegex = /asset-v1.(.*).type.(.*).block.(.*)/;\n\n/**\n * function matchImageStringsByIdentifiers\n *\n * matches two strings by comparing their regex capture groups using the `imageMatchRegex`\n */\nexport const matchImageStringsByIdentifiers = (a, b) => {\n  if (!a || !b || !(typeof a === 'string') || !(typeof b === 'string')) { return null; }\n  const matchA = JSON.stringify(a.match(imageMatchRegex)?.slice?.(1));\n  const matchB = JSON.stringify(b.match(imageMatchRegex)?.slice?.(1));\n  return matchA && matchA === matchB;\n};\n\nexport const stringToFragment = (htmlString) => document.createRange().createContextualFragment(htmlString);\n\nexport const getImageFromHtmlString = (htmlString, imageSrc) => {\n  const images = stringToFragment(htmlString)?.querySelectorAll('img') || [];\n\n  return Array.from(images).find((img) => matchImageStringsByIdentifiers(img.src || '', imageSrc));\n};\n\nexport const detectImageMatchingError = ({ matchingImages, tinyMceHTML }) => {\n  if (!matchingImages.length) { return true; }\n  if (matchingImages.length > 1) { return true; }\n\n  if (!matchImageStringsByIdentifiers(matchingImages[0].id, tinyMceHTML.src)) { return true; }\n  if (!matchingImages[0].width || !matchingImages[0].height) { return true; }\n  if (matchingImages[0].width !== tinyMceHTML.width) { return true; }\n  if (matchingImages[0].height !== tinyMceHTML.height) { return true; }\n\n  return false;\n};\n\nexport const openModalWithSelectedImage = ({\n  editor, images, setImage, openImgModal,\n}) => () => {\n  const tinyMceHTML = editor.selection.getNode();\n  const { src: mceSrc } = tinyMceHTML;\n\n  const matchingImages = images.current.filter(image => matchImageStringsByIdentifiers(image.id, mceSrc));\n\n  const imageMatchingErrorDetected = detectImageMatchingError({ tinyMceHTML, matchingImages });\n\n  const width = imageMatchingErrorDetected ? null : matchingImages[0]?.width;\n  const height = imageMatchingErrorDetected ? null : matchingImages[0]?.height;\n\n  setImage({\n    externalUrl: tinyMceHTML.src,\n    altText: tinyMceHTML.alt,\n    width,\n    height,\n  });\n\n  openImgModal();\n};\n\nexport const filterAssets = ({ assets }) => {\n  let images = [];\n  const assetsList = Object.values(assets);\n  if (assetsList.length > 0) {\n    images = assetsList.filter(asset => asset?.contentType?.startsWith('image/'));\n  }\n  return images;\n};\n\nexport const setAssetToStaticUrl = ({ editorValue, assets, lmsEndpointUrl }) => {\n  /* For assets to remain usable across course instances, we convert their url to be course-agnostic.\n   * For example, /assets/course/<asset hash>/filename gets converted to /static/filename. This is\n   * important for rerunning courses and importing/exporting course as the /static/ part of the url\n   * allows the asset to be mapped to the new course run.\n  */\n\n  // TODO: should probably move this to when the assets are being looped through in the off chance that\n  // some of the text in the editor contains the lmsEndpointUrl\n  const regExLmsEndpointUrl = RegExp(lmsEndpointUrl, 'g');\n  let content = editorValue.replace(regExLmsEndpointUrl, '');\n\n  const assetUrls = [];\n  const assetsList = Object.values(assets);\n  assetsList.forEach(asset => {\n    assetUrls.push({ portableUrl: asset.portableUrl, displayName: asset.displayName });\n  });\n  const assetSrcs = typeof content === 'string' ? content.split(/(src=\"|src=&quot;|href=\"|href=&quot)/g) : [];\n  assetSrcs.forEach(src => {\n    if (src.startsWith('/asset') && assetUrls.length > 0) {\n      const assetBlockName = src.substring(src.indexOf('@') + 1, src.search(/(\"|&quot;)/));\n      const nameFromEditorSrc = assetBlockName.substring(assetBlockName.indexOf('@') + 1);\n      const nameFromStudioSrc = assetBlockName.substring(assetBlockName.indexOf('/') + 1);\n      let portableUrl;\n      assetUrls.forEach((url) => {\n        const displayName = url.displayName.replace(/\\s/g, '_');\n        if (displayName === nameFromEditorSrc || displayName === nameFromStudioSrc) {\n          portableUrl = url.portableUrl;\n        }\n      });\n      if (portableUrl) {\n        const currentSrc = src.substring(0, src.search(/(\"|&quot;)/));\n        const updatedContent = content.replace(currentSrc, portableUrl);\n        content = updatedContent;\n      }\n    }\n  });\n  return content;\n};\n\nexport const fetchImageUrls = (images) => {\n  const imageUrls = [];\n  images.current.forEach(image => {\n    imageUrls.push({ staticFullUrl: image.staticFullUrl, displayName: image.displayName });\n  });\n  return imageUrls;\n};\n\nexport const selectedImage = (val) => {\n  const [selection, setSelection] = module.state.imageSelection(val);\n  return {\n    clearSelection: () => setSelection(null),\n    selection,\n    setSelection,\n  };\n};\n\n/**\n * function updateImageDimensions\n *\n * Updates one images' dimensions in an array by identifying one image via a url string match\n * that includes asset-v1, type, and block. Returns a new array.\n *\n * @param {Object[]} images - [{ id, ...other }]\n * @param {string} url\n * @param {number} width\n * @param {number} height\n *\n * @returns {Object} { result, foundMatch }\n */\nexport const updateImageDimensions = ({\n  images, url, width, height,\n}) => {\n  let foundMatch = false;\n\n  const result = images.map((image) => {\n    const imageIdentifier = image.id || image.url || image.src || image.externalUrl;\n    const isMatch = matchImageStringsByIdentifiers(imageIdentifier, url);\n    if (isMatch) {\n      foundMatch = true;\n      return { ...image, width, height };\n    }\n    return image;\n  });\n\n  return { result, foundMatch };\n};\n"],"mappings":"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"}